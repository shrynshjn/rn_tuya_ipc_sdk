(this["webpackJsonpiot-main"]=this["webpackJsonpiot-main"]||[]).push([[0],{770:function(e,t,n){},776:function(e,t,n){"use strict";n.r(t);var a=n(105),r=n(70),o=(n(424),n(55)),c=n.n(o),i=n(63),u=n(21),l=n(73),s=n(418),d=n(94),p=n(420),f=n(317),b=(n(756),n(195)),h=n(64),m=n(0),g=n.n(m),v=n(413),O=n(134),j=n(61),y=n(315),_=n(23),w=n(321),S=n(260),C=n(166),R=function(e){var t=l.a.getGlobalData()||{},n=(null===t||void 0===t?void 0:t.layoutData)||{};!function(e){var t=l.a.getGlobalData();l.a.setGlobalData(Object(d.a)(Object(d.a)({},t),e))}({layoutData:Object(d.a)(Object(d.a)({},n),e)})},E=n(320),D=n.n(E),A=(n(757),n(45)),I=n(303),N=n.n(I),x=n(414),k={error:function(e){e&&D.a.error(e)}},L=n.n(x).a.get("csrf-token");window.csrf=L;var M=function(e){var t=N.a.create(e),n=new A.LoginInterceptor({handleLogin:T,checkNeedLogin:U}),a=new A.AtopInterceptor({message:k});return t.interceptors.response.use(n.resOnFulfilled),t.interceptors.response.use(void 0,a.resOnRejected),t}({headers:{"csrf-token":window.csrf}}),P={daily:"https://auth.fast-daily.tuya-inc.cn",pre:"https://auth.fast-cn.wgine.com",prod:"https://auth.tuya.com"};function T(e){var t=P[window.env]||P.daily,n=encodeURIComponent(window.location.href);window.location.href="".concat(t,"?from=").concat(n)}var z=["USER_SESSION_INVALID","USER_SESSION_LOSS","REMOTE_SESSION_API_INVALID"];function U(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.errorCode;return z.includes(n)}function G(e){return M(e).then(A.getAtopResult).catch((function(e){return e.errorMsg&&D.a.error(e.errorMsg),Object(A.forwardSimpleError)(e)}))}var B=n(224),F=n(90),V=n(187),q=n(40),X=n(192),H={};function J(e,t){return"".concat(e,"_").concat(t)}var K,W=n(247),Y=n(244),Q=null;function Z(e,t){var n=function(e,t){var n;return null===(n=H[J(e,t)])||void 0===n?void 0:n.client}(e,t);return n||(n=function(e,t){return new B.a({dsn:e,release:t,integrations:[].concat(Object(r.a)(F.b),[new W.a.BrowserTracing,new V.c.Breadcrumbs({console:!1}),new V.c.GlobalHandlers({onerror:!0,onunhandledrejection:!1}),new V.c.Dedupe]),ignoreErrors:["ResizeObserver loop limit exceeded","ResizeObserver loop completed with undelivered notifications."],beforeSend:Y.beforeSend,maxValueLength:5e3})}(e,t)),function(e,t,n){var a=H[J(e,t)]||{client:n,refCount:0};a.refCount?a.refCount+=1:H[J(e,t)]=a}(e,t,n),Q||(Q=q.b().getClient()),q.b().bindClient(n),X}var $,ee=function(){G({url:"/global/iotcommon/api/cart/count",method:"POST"}).then((function(e){R({shopCartNum:e})}))},te=function(){G({url:"/global/api/im/getImNum",method:"POST"}).then((function(e){R({imUnreadCount:e})}))};!function(e){e.updateShopCartNum="updateShopCartNum",e.updateImUnreadCount="updateImUnreadCount",e.setPartialLayoutData="setPartialLayoutData",e.changeRoute="tuya_route_change",e.childRouteChanged="tuya_child_route_change",e.parentRouteChanged="tuya_parent_route_change",e.sentryMicroAppChange="sentryMicroAppChange"}($||($={}));var ne=(K={},Object(a.a)(K,$.updateShopCartNum,ee),Object(a.a)(K,$.updateImUnreadCount,te),Object(a.a)(K,$.setPartialLayoutData,R),Object(a.a)(K,$.changeRoute,R),Object(a.a)(K,$.sentryMicroAppChange,(function(e){Z(e.dsn,e.release)})),K);function ae(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=[],o=Object(h.a)(e);try{for(o.s();!(t=o.n()).done;){var c=t.value;if(c.p=n.concat(c.key),a.push(c),c.menuList){var i=n.concat(c.key);a.push.apply(a,Object(r.a)(ae(c.menuList,i)))}}}catch(u){o.e(u)}finally{o.f()}return a}function re(e){try{var t,n=function(e){var t=e,n=t.attached,a=t.menu,o=a.main,c=a.person,i=a.other;return[].concat(Object(r.a)(ae(o)),Object(r.a)(ae(c)),Object(r.a)(ae(i)),Object(r.a)(ae(n)))}(e),a=Object(h.a)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o.pattern&&new RegExp(o.pattern).test(location.pathname))return o.p}}catch(c){a.e(c)}finally{a.f()}}catch(i){return[]}}var oe,ce={data:void 0,timezone:Object(O.d)(),region:Object(j.c)(),lang:Object(_.e)(Object(_.d)()),cookies:Object(S.b)(Object(C.parseCookies)()),acc:y.a.none,activeKeys:[],shopCartNum:0,layout:{}},ie=Object.keys(ce),ue=n(417),le=n.n(ue),se=n(95),de=["region","acc","lang","data","timezone","cookies","layout"],pe=function(e){var t=e.children,n=e.currentRegion,a=e.regions,r=e.onMenuClick,o=function(){var e=Object(m.useState)(ce),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(m.useEffect)((function(){l.a.getGlobalData(),l.a.addGlobalDataListener((function(e){e.layoutData&&a((function(t){return Object(d.a)(Object(d.a)({},Object(v.pick)(t,ie)),e.layoutData)}))})),Object(w.b)({ctx:{},fetch:M,strategy:w.a.CacheFirst}).then((function(e){var t=re(e.permission.permissions);R({data:e,activeKeys:t})})),ee()}),[]),n}(),c=(o.region,o.acc),u=o.lang,s=o.data,h=o.timezone,g=o.cookies,O=o.layout,j=Object(p.a)(o,de);return Object(se.jsx)(se.Fragment,{children:Object(se.jsx)(le.a,{autoInsertSpaceInButton:!1,children:Object(se.jsx)(b.b,{value:{acc:c,lang:u,layout:O,fetch:M},children:s?Object(se.jsx)(f.a.Provider,{value:{regions:a,currentRegion:n},children:Object(se.jsx)(f.b,Object(d.a)(Object(d.a)({timezone:h,cookies:g},j),{},{data:s,onSelectItem:r,children:t}))}):null})})})},fe=n(243),be=n.n(fe),he=(n(768),n(80)),me=n.n(he);window.getActiveApps=l.b;var ge=function(e){var t=e.config,n=Object(u.h)(),a=Object(m.useRef)(),r=Object(m.useState)(!1),o=Object(i.a)(r,2),c=o[0],d=o[1];function p(e){var r=e.method,o=e.url,c=Object(u.e)("/bulletin/:id",o);c&&(o="/exp/bulletin/detail?id="+c.params.id);var i=a.current;if(i&&Object(u.e)(i.path,o)){var s=i.path.replace("/*","");l.a.setData(null===i||void 0===i?void 0:i.name,{type:$.childRouteChanged,payload:{method:r,url:o.replace(s,"")}})}else{var d=t.apps.find((function(e){return!!Object(u.e)(e.path,o)}));d?n(o,{replace:"replace"===r}):window.location.href=o}}Object(m.useEffect)((function(){t.apps.forEach((function(e){l.a.addDataListener(e.name,(function(e){e.type===$.parentRouteChanged?p(e.payload):function(e){if(e.type){var t=ne[e.type];t&&t(e.payload)}}(e)}))}))}),[]);return Object(m.useEffect)((function(){if(!c){var e=setInterval((function(){!!document.querySelector("#__next .layout")&&d(!0)}),100);return function(){clearInterval(e)}}}),[c]),me()(g.a.Fragment,null,me()(pe,{currentRegion:t.currentRegion,regions:t.regions,onMenuClick:function(e){te(),p({method:"push",url:e.url})}},me()(u.d,null,t.apps.map((function(e){return me()(u.b,{key:e.name,caseSensitive:!0,path:e.path,element:me()(g.a.Fragment,null,!c&&me()(be.a,{className:"micro-app_spin",size:"large"}),me()("div",{className:"micro-app_container"},me()("micro-app",{name:e.name,url:e.url,onMounted:function(){oe=Document.prototype.createElement,Document.prototype.createElement=function(e,t){var n=oe.call(this,e,t);return Object.defineProperty(n,"firstChild",{get:function(){var e=n.childNodes[0]||null;return e&&(e.__MICRO_APP_NAME__=n.__MICRO_APP_NAME__),e}}),n},document.querySelectorAll("micro-app, micro-app-body").forEach((function(e){e.setAttribute("style","position: static")})),a.current=e},onUnmount:function(){Document.prototype.createElement=oe,setTimeout((function(){!document.querySelector("#__next .layout")&&d(!1)}),200)}})))})})),me()(u.b,{path:"/index",element:me()(u.a,{to:"/"})}),me()(u.b,{path:"*",element:me()(s.a,null)}))))},ve=n(313),Oe=(n(770),n(394));G({url:"/api/micro/config",method:"POST"}).then((function(e){e.apps=e.apps.filter((function(t){return!t.regions||t.regions.includes(e.currentRegion)})),"prod"===window.env&&"AY"===e.currentRegion&&Oe.a({dsn:"https://89e78ffc80e84c57b7f08ed452ffbffb@sentry.tuyacn.com/1042",integrations:[].concat(Object(r.a)(F.b),[new W.a.BrowserTracing,new V.c.Breadcrumbs({console:!1}),new V.c.GlobalHandlers({onerror:!0,onunhandledrejection:!1}),new V.c.Dedupe]),release:"20220317-055012031-f8bc9c98e4",tracesSampleRate:1,ignoreErrors:["ResizeObserver loop limit exceeded","ResizeObserver loop completed with undelivered notifications."],environment:window.env,beforeSend:Y.beforeSend,maxValueLength:5e3}),"undefined"!==typeof window&&(window.Sentry=X,window.Raven=X);var t,n=e.apps,o=n.find((function(e){return e.url.startsWith("http://localhost")}));o&&(t=Object(a.a)({},o.name,[{loader:function(e,t){return t.includes("dll")?e.replace("var dll_","self.dll_"):e}}])),l.a.preFetch(Object(r.a)(n)),l.a.start({fetch:function(e,t,n){return window.fetch(e,Object.assign(t,{credentials:"same-origin"})).then((function(e){return e.text()}))},plugins:{global:[{loader:function(e,t){var n="//# sourceURL=".concat(t);return e.startsWith("__NEXT_DATA__")?e.replace("__NEXT_DATA__","self.__NEXT_DATA__"):"\n".concat(e,"\n").concat(n)}}],modules:t}}),c.a.render(Object(se.jsx)(ve.a,{children:Object(se.jsx)(ge,{config:e})}),document.getElementById("root"))}))}},[[776,1,2]]]);