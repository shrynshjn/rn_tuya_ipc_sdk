/**
 * TPM 3.3.27
 * Tuya Point Analytics Manager - tpm.js
 *
 * Copyright 2018-2021 wanglk@tuya.com
 *
 * Released under the MIT License
 *
 * Released on: December 14, 2021
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).TPM=t()}(this,function(){"use strict";var e,t,r,n,i,o,a=(t=[],r="object"==typeof document&&document,n=r&&r.documentElement.doScroll,i="DOMContentLoaded",!(o=r&&(n?/^loaded|^c/:/^loaded|^i|^c/).test(r.readyState))&&r&&r.addEventListener(i,e=function(){for(r.removeEventListener(i,e),o=1;e=t.shift();)e()}),function(e){o?setTimeout(e,0):t.push(e)});function u(e,t,r){return!!e&&(t=t||"click","function"==typeof r?(e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r),!0):void 0)}function h(e){return e.target||(e.pageX=e.x,e.pageY=e.y,e.target=e.srcElement),void 0===e.layerX&&(e.layerX=e.offsetX),void 0===e.layerY&&(e.layerY=e.offsetY),e}var c=function(e,t){void 0===e&&(e="log"),t=[].slice.call(t,0);var r=["["+e+"] TPM logger:"];console[e].apply(null,r.concat(t))};c.log=function(){c("log",arguments)},c.warn=function(){c("warn",arguments)},c.error=function(){c("error",arguments)},c.info=function(){c("info",arguments)};var s={sdkVersion:"3.3.27",appVersion:"1.0.0",inFrame:!(c.debug=function(){c("debug",arguments)}),debug:!0,domain:"tuya.com",routerListener:!0,startTime:{startTime:+new Date,type:0},referrer:"",currentTime:+new Date,gatherMore:[],scrollDom:null,recoverGatherMore:[],appId:"",pageUrl:"",gatherServer:"//tpm.tuyacn.com/tpm.gif",gatherError:!0,previous_uuid:"",previous_event:""},l=window;l.$PAGE_DATA&&l.$PAGE_DATA.startTime&&(s.startTime={startTime:+l.$PAGE_DATA.startTime,type:1});var f=window,p=f.navigator,d=f.document,g=f.screen,m=f.setImmediate||function(e){setTimeout(e,1)};function v(t){try{return f.encodeURIComponent(t)}catch(e){return t}}function y(t){try{return f.decodeURIComponent(t)}catch(e){return t}}function b(e){return e?/^https?:\/\//.test(e)?e:f.location.origin+e:""}function L(e,t){return e&&e.getAttribute&&e.getAttribute(t)||""}function S(e){for(;e&&e!==d.body;)return e;return null}function T(e){if("string"!=typeof e)throw"trim need a string as parameter";for(var t=e.length,r=0,n=/(\u3000|\s|\t|\u00A0)/;r<t&&n.test(e.charAt(r));)r+=1;for(;r<t&&n.test(e.charAt(t-1));)--t;return e.slice(r,t)}function w(e,t,r){if(new RegExp(/^(http|https|ftp)?(?:[\:\/]*)([a-z0-9\.-]*)(?:\:([0-9]+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/).test(e))try{var n=e.split("?")[1];if(n){var i=T(n).split("=");t[i[0]]=r(i[1])}}catch(e){console.warn("url 解析错误")}return t}function I(e,t){for(var r,n=T((r=(t=void 0===t?1:0)?y:function(e){return e})(e)).split("&"),i={},o=0,a=n.length;o<a;o++)if(n[o]){var u=n[o].split("="),c=u[0],s=u[1];u.length<2&&(s=c,c="_"),2<u.length&&(i=w(s=u.slice(1).join("="),i,r)),i[c]?(P(i[c])||(i[c]=[i[c]]),i[c].push(r(s))):i[c]=r(s)}return i}function x(e,t){for(var r=-1,n=e.length;++r<n;)t(e[r],r)}function _(e){if(s.debug){try{e=y(e)}catch(e){}c.log("debug => "+e)}}function E(){return f.location.href}var C=function(){return+new Date},P=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)};var O,N,M,A,k,D,R,j=(O=window.JSON||{},"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+B(this.getUTCMonth()+1)+"-"+B(this.getUTCDate())+"T"+B(this.getUTCHours())+":"+B(this.getUTCMinutes())+":"+B(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof O.stringify&&(M=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,D={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},O.stringify=function(e,t,r){var n;if(k=A="","number"==typeof r)for(n=0;n<r;n+=1)k+=" ";else"string"==typeof r&&(k=r);if((R=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,r){var n,i,o,a,u,c=A,s=r[t];switch(s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(t)),"function"==typeof R&&(s=R.call(r,t,s)),typeof s){case"string":return U(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case null:return String(s);case"object":if(!s)return"null";if(A+=k,u=[],"[object Array]"===Object.prototype.toString.apply(s)){for(a=s.length,n=0;n<a;n+=1)u[n]=e(n,s)||"null";return o=0===u.length?"[]":A?"[\n"+A+u.join(",\n"+A)+"\n"+c+"]":"["+u.join(",")+"]",A=c,o}if(R&&"object"==typeof R)for(a=R.length,n=0;n<a;n+=1)"string"==typeof R[n]&&(o=e(i=R[n],s))&&u.push(U(i)+(A?": ":":")+o);else for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(o=e(i,s))&&u.push(U(i)+(A?": ":":")+o);return o=0===u.length?"{}":A?"{\n"+A+u.join(",\n"+A)+"\n"+c+"}":"{"+u.join(",")+"}",A=c,o}}("",{"":e})}),"function"!=typeof O.parse&&(N=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,O.parse=function(e,a){var t;if(e=String(e),N.lastIndex=0,N.test(e)&&(e=e.replace(N,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return t=(0,eval)("("+e+")"),"function"==typeof a?function e(t,r){var n,i,o=t[r];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(void 0!==(i=e(o,n))?o[n]=i:delete o[n]);return a.call(t,r,o)}({"":t},""):t;throw new SyntaxError("JSON.parse")}),O);function B(e){return e<10?"0"+e:e}function U(e){return M.lastIndex=0,M.test(e)?'"'+e.replace(M,function(e){var t=D[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function G(t){try{return j.parse(t)}catch(e){try{return(0,eval)("("+t+")")}catch(e){return{_:t}}}}var J=function(e){return j.stringify((a=[],u=[],function e(t,r){var n,i,o;if("object"!=typeof t||null===t||t instanceof Boolean||t instanceof Date||t instanceof Number||t instanceof RegExp||t instanceof String)return t;if(t==t.window)return"[[Circular Window]]";if(t.nodeType)return"[[DOM HTMLElement]]";for(n=0;n<a.length;n+=1)if(a[n]===t)return{$ref:u[n]};if(a.push(t),u.push(r),"[object Array]"===Object.prototype.toString.apply(t))for(o=[],n=0;n<t.length;n+=1)o[n]=e(t[n],r+"["+n+"]");else for(i in o={},t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=e(t[i],r+"["+j.stringify(i)+"]"));return o}(e,"$")));var a,u};function H(e){return/^(https?:)?\/\//.test(e)}function z(e){if("?"===e.charAt(0))e=e.substr(1);else{var t=function(e){var t=e.match(/^(http|https|ftp)?(?:[\:\/]*)([a-z0-9\.-]*)(?:\:([0-9]+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/i),r=new Object;r.protocol="",r.host=t[2],r.port="",r.path="",r.query="",r.fragment="",t[1]&&(r.protocol=t[1]);t[3]&&(r.port=t[3]);t[4]&&(r.path=t[4]);t[5]&&(r.query=t[5]);t[6]&&(r.fragment=t[6]);return r}(e);t.query&&(e=t.query)}for(var r,n={},i=e.split("&"),o=-1,a=i.length;++o<a;)r=i[o].split("="),n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]);return n}var V=function(){return(V=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function $(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function q(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,u=o.length;a<u;a++,i++)n[i]=o[a];return n}function F(e){if("string"!=typeof e)throw"trim need a string as parameter";for(var t=e.length,r=0,n=t-1,i=/(\u3000|\s|\t|\u00A0)/;r<t&&i.test(e.charAt(r));)++r;for(;0<=n&&i.test(e.charAt(n));)--n;return e.substring(r,n+1)}function W(e,t,r){if(r=r||{},void 0!==t){if(r=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(r),null===t&&(t="",r.expires=-1),"number"==typeof r.expires){var n=r.expires,i=r.expires=new Date;i.setTime(i.getTime()+864e5*n)}var o=function(e){try{return r.raw?e:encodeURIComponent(e)}catch(e){}return e};return window.document.cookie=[o(e),"=",o(t),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}t=null;for(var a=window.document.cookie,u=a?a.split("; "):[],c=-1,s=u.length,l=e.length+1;++c<s;)if((a=F(u[c])).substring(0,l)===e+"="){f=a.substring(l),t=r.raw?f:decodeURIComponent(f);break}return t;var f}var X={screenSize:function(){return g.width+"x"+g.height},winSize:function(){var e=function(){var e,t,r=d.body;f.innerWidth?(e=f.innerWidth,t=f.innerHeight):r&&r.clientWidth&&(e=r.clientWidth,t=r.clientHeight);var n=d.documentElement;return n&&n.clientHeight&&n.clientWidth&&(e=n.clientWidth,t=n.clientHeight),{width:e,height:t}}();return e.width+"x"+e.height},scrollPostion:function(){var e,t;return d.documentElement&&d.documentElement.scrollTop?(e=d.documentElement.scrollTop,t=d.documentElement.scrollLeft):d.body&&(e=d.body.scrollTop,t=d.body.scrollLeft),t+"x"+e},appCode:function(){return p.appCodeName},appName:function(){return-1<p.appName.indexOf("Microsoft Internet Explorer")?"MSIE":p.appName},platform:function(){return p.platform},language:function(){return p.systemLanguage||p.language},timezone:function(){return(new Date).getTimezoneOffset()/60},dpr:function(){return f.devicePixelRatio||1}},Y="_tpmPlt",Z="_tpmSource",K={url:function(){var e=s.pageUrl;return v(e=e||E())},appId:function(e){var t,r,n,i;return""===(e=e||s.appId)&&(t="tpm-app-id",n=d.getElementsByName(t),i=0<r?r:0,e=(n.length>i?n[i].content:"")||""),e},referrer:function(){if(s.referrer)return v(s.referrer);var e=d.referrer;if(!e&&f.parent)try{e=f.parent.document.referrer}catch(e){}return e&&!e.match(/^[^\?&#]*.swf([\?#])?/)||(e=function(e,t,r,n){if(!e)return"";t+=r=r||"=";var i=e.indexOf(t);if(!~i)return"";i+=t.length;var o=e.indexOf(n,i);return o<i&&(o=e.length),e.substring(i,o)}(E(),"ref","=","&")||e),e=e?v(e):"",s.referrer=e},getFirstLoadTime:function(){return s.startTime},getPageRenderTime:function(){var e=null;return 1===s.startTime.type&&(e=C()-s.startTime.startTime),e},getPageStayTime:function(){return C()-this.getFirstLoadTime().startTime},setCurrentTime:function(){s.currentTime=C()},getCurrentPageShowTime:function(){return C()-s.currentTime},getsubAppId:function(){return W.get("_tpmSubAppId")||""},getExtraInfos:function(){var t="";try{t=JSON.stringify(JSON.parse(W.get("_tpmExtraInfos"))||"")}catch(e){t="",console.warn("cookie 解析错误：_tpmExtraInfos 的值不是 JSON 字符串")}return t},setPageLoadTime:function(){var e={time:C(),referrer:this.url()};W.set(Y,J(e),{domain:s.domain,path:"/"})},getPageLoadTime:function(){var e=this.referrer(),t=null;if(e){var r=W.get(Y);r&&(r=G(r)).referrer===e&&(t=C()-r.time)}return W.set(Y,null,{domain:s.domain,path:"/"}),t},getEX:function(){var e={};if(0<s.recoverGatherMore.length)e.gatherMore=s.recoverGatherMore;else{for(var t,r=function(e,t){if(e.filter)return e.filter(t);for(var r=[],n=-1,i=e.length;++n<i;)t(e[n],n)&&r.push(e[n]);return r}(d.getElementsByTagName("input"),function(e,t){return"tpm-gather-more"===e.name}),n=-1;t=r[++n];)s.gatherMore.push(G(t.value));0<s.gatherMore.length&&(e.gatherMore=s.gatherMore)}return v(J(e))},setPageSource:function(){var e=f.location.search;if(e){var t=I(e.substring(1));t&&t._source&&W.set(Z,v(t._source),{domain:s.domain,expires:1,path:"/"})}},getPageSource:function(){var e=W.get(Z);return e||""},scrollDomPostion:function(){var e=s.scrollDom;if(e&&"number"==typeof e.scrollTop){var t=e.getBoundingClientRect(),r=e.scrollTop+t.top||0;return(e.scrollLeft+t.left||0)+"x"+r}return""},pageLang:function(){return W.get("_tpmLang")||""}},Q="_tpmGuid",ee="_tpmSeqId",te=W.set=function(e,t,r){return W(e,t,r)},re=W.get=function(e){return W(e)};function ne(e){for(var t="",r=16;r--;)t+=Math.floor(16*Math.random()).toString(16);return""+e+t}var ie={guid:function(){var e=re(Q);return e||(e=ne("TY-"),te(Q,e,{domain:s.domain,expires:18250,path:"/"})),e},gid:function(){return this.guid()},uid:function(){var e=re("_tpmSid");return e=e||"guest"},seq_id:function(){var e=re(ee)||ne("seq_id_");return te(ee,e,{domain:s.domain,expires:1/24/2,path:"/"}),e}},oe={getTiming:function(){var e=window.performance;return e&&e.timing&&JSON.stringify?JSON.stringify(e.timing):""}},ae={TPM_CIRCLE:!0,TPM_CIRCLE_CHILDLIST:!0,TPM_CIRCLE_SIBLINGSLIST:!1,status:null,cancel:!1,highlight:!1,historyDomList:[]};function ue(e){ge(e.data)}var ce,se=!1,le=!1;function fe(e){return 1==+window.dsBridge.hasNativeMethod(e)}function pe(e){var t,r,n=JSON.parse(JSON.stringify(e)),i=ae.status;!window.parent||"circle"!==i&&"pageLoad"!==n.type||window.parent.postMessage(n,"*"),le||window.dsBridge&&window.dsBridge.call&&window.dsBridge.hasNativeMethod&&(fe("plugin.autotrack.track")||fe("plugin.circleselect.getConfig")||fe("plugin.circleselect.circle")||fe("plugin.apm.event"))&&(le=se=!0),se&&("circle"!==i?function(e){e.ec&&fe("plugin.apm.event")&&window.dsBridge.call("plugin.apm.event",function(e){var t={};try{t=JSON.parse(e.ea)}catch(e){t=t}return{event:e.ec,attributes:t}}(e));fe("plugin.autotrack.track")&&window.dsBridge.call("plugin.autotrack.track",de(e))}(n):"pageClick"===n.type&&(r=n,fe("plugin.circleselect.circle")&&window.dsBridge.call("plugin.circleselect.circle",de(r))),"pageLoad"===n.type&&(t=n.url,fe("plugin.circleselect.getConfig")&&window.dsBridge.call("plugin.circleselect.getConfig",{url:t},function(e){ge(V(V({},e),{domList:e.xpathArr,xp:e.xpath}))})))}function de(e){var t={pageLoad:"page.enter",pageClick:"page.click",pageExit:"page.leave",UA:"page.ua",pageVisible:"page.visible",pageHidden:"page.hidden"},r={ec:e.ec,extraInfos:{sub_app_id:e.sub_app_id,app_extra_infos:e.app_extra_infos}};try{r.ea=JSON.parse(e.ea)}catch(e){r=r}return{xpath:e.xp,xpathArr:e.domList,eventType:t[e.type],currentPage:e.url,refererPage:e.ref,text:e.text,image:e.image,business:r,hasSibling:e.hasSibling,uuid:e.uuid,previous_uuid:e.previous_uuid,previous_event:t[e.previous_event]}}function ge(e){switch(e.status){case"circle":!function(){if(d.getElementById("tianyan"))return;var e=d.createElement("style");e.setAttribute("type","text/css"),e.setAttribute("id","tianyan"),e.innerHTML="\n    .tpm-circled-style {\n      outline: 1px solid red !important;\n      outline-offset: -1px !important;\n    }\n    .tpm-circled-style-dashed {\n      outline: 1px dashed red !important;\n      outline-offset: -1px !important;\n    }",d.getElementsByTagName("head")[0].appendChild(e)}(),ae.status="circle";break;case"browser":!function(){var e=d.getElementById("tianyan");if(!e)return;e.parentNode.removeChild(e)}(),ae.status="browser"}var t;e.historyDomList&&(ae.historyDomList=e.historyDomList),"boolean"==typeof e.highlight&&(ae.highlight=e.highlight,t=ae.historyDomList,ae.highlight?Ie(t,function(e){e&&(e.classList.add("tpm-circled"),e.classList.add("tpm-circled-style"))}):Ie(t,function(e){xe(e)})),"boolean"!=typeof e.TPM_CIRCLE_CHILDLIST&&"boolean"!=typeof e.TPM_CIRCLE_SIBLINGSLIST||(ae.TPM_CIRCLE_CHILDLIST=e.TPM_CIRCLE_CHILDLIST,ae.TPM_CIRCLE_SIBLINGSLIST=e.TPM_CIRCLE_SIBLINGSLIST,e.submit||function(e,t){var r=ae.TPM_CIRCLE_CHILDLIST,n=ae.TPM_CIRCLE_SIBLINGSLIST,i=t.domList||[],o=function e(t,r){for(var n=0;n<t.children.length;n+=1)r.push(t.children[n]),e(t.children[n],r);return r}(e,[]);be(o,r?function(e){Se(i,e),e&&(e.classList.add("tpm-circled"),e.classList.add("tpm-circled-style"))}:function(e){Le(i,e),xe(e)});var a=ve(e);be(a,n?function(e){Se(i,e),e&&(e.classList.add("tpm-circled"),e.classList.add("tpm-circled-style-dashed"))}:function(e){Le(i,e),xe(e)});t.cancel||pe(V(V({},t),{TPM_CIRCLE_CHILDLIST:r,TPM_CIRCLE_SIBLINGSLIST:n,domList:Te(i)}))}(we(e.xp),e)),e.cancel&&Ie(e.domList,function(e){xe(e)})}function he(e){return e.tagName&&"string"==typeof e.tagName?e.tagName.toLowerCase():String(e.tagName).toLowerCase()}function me(e){for(var t="",r=e;r&&1==r.nodeType;r=e=e.parentNode){for(var n=0;r=r.previousElementSibling;)r.tagName==e.tagName&&(n+=1);var i=he(e),o=n+1,a=ve(e).length||0;t="/"+i+(o=1<o||0<a?"["+o+"]":"")+t}return t}function ve(e){for(var t=[],r=e.parentNode&&e.parentNode.children||[],n=0;n<r.length;n+=1)r[n]!==e&&e.tagName===r[n].tagName&&t.push(r[n]);return t}function ye(e,t,r){var n=ae.TPM_CIRCLE_CHILDLIST,i=ae.TPM_CIRCLE_SIBLINGSLIST;if(!e||!e.classList.contains("tpm-circled")){if(n){t(q([e],function e(t,r){for(var n=0;n<t.children.length;n+=1)t.children[n].classList.contains("tpm-circled")||(r.push(t.children[n]),e(t.children[n],r));return r}(e,[])))}if(i){var o=ve(e);t([e]),r(q(o))}}}function be(e,t){for(var r=0;r<e.length;r+=1)t(e[r])}function Le(e,t){var r=e.indexOf(me(t));-1<r&&e.splice(r,1)}function Se(e,t){var r=me(t);e.indexOf(r)<0&&e.push(r)}function Te(e){for(var t=[],r=0;r<e.length;r+=1)e.indexOf(e[r])===r&&t.push(e[r]);return t}function we(e){return d.evaluate(e,d,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function Ie(e,t){for(var r=0;r<e.length;r+=1){t(we(e[r]))}}function xe(e){if(e){var t=e.classList;t.contains("tpm-circled")&&t.remove("tpm-circled"),t.contains("tpm-circled-style")&&t.remove("tpm-circled-style"),t.contains("tpm-circled-style-dashed")&&t.remove("tpm-circled-style-dashed")}}function _e(e){if("circle"===ae.status){var t=S(h(e).target);t&&ye(t,function(e){for(var t=0;t<e.length;t+=1)e[t].classList.add("tpm-circled-style")},function(e){for(var t=0;t<e.length;t+=1)e[t].classList.add("tpm-circled-style-dashed")})}}function Ee(e){if("circle"===ae.status){var t=S(h(e).target);t&&ye(t,function(e){for(var t=0;t<e.length;t+=1)e[t].classList.remove("tpm-circled-style")},function(e){for(var t=0;t<e.length;t+=1)e[t].classList.remove("tpm-circled-style-dashed")})}}function Ce(e){var t=K.getFirstLoadTime(),r=C(),n=ie.gid()+"-"+r;return function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({ss:X.screenSize(),ws:X.winSize(),sp:X.scrollPostion(),ac:X.appCode(),an:X.appName(),pf:X.platform(),lg:X.language(),tz:X.timezone(),dpr:X.dpr(),appid:K.appId(),csp:K.scrollDomPostion(),gid:ie.gid(),uid:ie.uid(),sver:s.sdkVersion,aver:s.appVersion,now:r,flt:t.startTime+","+t.type,src:K.getPageSource(),url:K.url(),ref:K.referrer(),lang:K.pageLang(),uuid:n,previous_uuid:s.previous_uuid,previous_event:s.previous_event,seq_id:ie.seq_id(),sub_app_id:K.getsubAppId(),app_extra_infos:K.getExtraInfos()},e)}function Pe(e,t,r){if(e&&t){var n=r||"";"string"==typeof r&&(n=r),"object"==typeof r&&(n=J(r)),n=function(t){try{var e=j.parse(t),r={};for(var n in e)r[n]=v(e[n]);return J(r)}catch(e){return t}}(n);try{Re({type:e,ec:t||"",ea:n})}catch(e){_(e)}}}function Oe(e,t){Pe("UA",e,t)}function Ne(){s.inFrame||(K.setPageSource(),Re({type:"pageLoad",prt:K.getPageRenderTime(),plt:K.getPageLoadTime(),pex:K.getEX(),pfmc:v(oe.getTiming())}),s.gatherMore=[],s.recoverGatherMore=[])}function Me(e){var t=h(e),r=S(t.target);if(r){var n,i,o,a,u,c;n=L(r,"data-tpm"),i=L(r,"data-tpm-args");var s=function(e){var t={tagName:he(e)},r=e.childNodes[0];if(r&&r.nodeValue&&r.nodeValue.trim()){var n="button"===he(e);t.text=n?r.nodeValue.trim():r.nodeValue.trim().substring(0,15)}else"input"===he(e)&&"button"===e.getAttribute("type")&&(t.text=e.value);return e.value&&"password"!==e.getAttribute("type")&&(t.value=e.value),"img"===he(e)&&(t.image=e.attributes.src&&e.attributes.src.nodeValue||""),{content:JSON.stringify(t),image:t.image||"",text:t.text||""}}(r),l=s.content,f=s.image,p=s.text;n&&(a=(o=I(n)||{}).name||o._||"",u=o.value),i&&(a=n,u=i),"object"!=typeof u&&(u=u?{value:u}:{});var d,g=r&&r.href;g&&(u.eh=v(g),new RegExp("^javascript:").test(g)||"#"===g||K.setPageLoadTime()),c={x:(d=t).pageX,y:d.pageY},u.ep=~~c.x+"x"+~~c.y,u.xp=me(r),Re({type:"pageClick",ea:u.value||"",ec:a||"",eh:u.eh||"",ep:u.ep,xp:u.xp||"",ct:v(l),image:f,text:p,evt:t,el:r})}}function Ae(t){if(s.gatherError+""!="false"){var e=(t||0).message,r="pageError",n={};e&&(0===e.indexOf("Script error.")&&(r="unknownError"),x(["filename","lineno","colno","message","timeStamp"],function(e){n[e]=t[e]}),Re({type:"pageError",ea:J({$type:r,ex:J(n)})}))}}function ke(e){Re({type:"pageHidden",cpst:K.getCurrentPageShowTime()}),Re({type:"pageExit",pst:K.getPageStayTime()})}function De(e){"hidden"===document.visibilityState&&Re({type:"pageHidden",cpst:K.getCurrentPageShowTime()}),"visible"===document.visibilityState&&(K.setCurrentTime(),Re({type:"pageVisible"}))}function Re(e){var t=e||{},r=t.el,n=t.evt,i=function(t,e){try{return e.forEach(function(e){t[e]&&(t[e]=t[e].substring(0,400))}),t}catch(e){return t}}(Ce($(t,["el","evt"])),["ea","url","ct","eh","ref","src","text","image"]);if(s.previous_event=i.ec||"",s.previous_uuid=i.uuid,K.appId()){if("circle"!==ae.status){var o=function(e){var t="";for(var r in e)""===t?t=r+"="+e[r]:t+="&"+r+"="+e[r];return s.gatherServer+"?"+t}(i);_(o),m(function(){(new Image).src=o})}"circle"===ae.status&&"pageClick"===i.type&&(i=function(e){var t=e.evt,r=e.el,n=$(e,["evt","el"]);t.stopPropagation(),t.preventDefault();var i=[],o=Boolean(ve(r).length);return ye(r,function(e){for(var t=0;t<e.length;t+=1)e[t].classList.add("tpm-circled-style"),e[t].classList.add("tpm-circled"),i.push(me(e[t]))},function(e){for(var t=0;t<e.length;t+=1)e[t].classList.add("tpm-circled-style-dashed"),e[t].classList.add("tpm-circled"),i.push(me(e[t]))}),V(V({},n),{domList:Te(i),hasSibling:o})}(V({el:r,evt:n},i))),pe(i)}else c.error("appId is require, must to setting.")}function je(e){e&&(H(e)||(e=y(e)),s.gatherServer=e)}function Be(e){void 0!==e&&(s.gatherError=e)}function Ue(e){void 0!==e&&(s.appId=e)}function Ge(e){e&&(s.appVersion=e)}function Je(e){e&&(s.pageUrl=b(e))}function He(e){var t;e?(/([a-zA-Z0-9_\-]+\.){1,}[a-zA-Z]{2,}$/.test(t=e)||"localhost"===t||/^([0-9]+\.){3}[0-9]{1,}$/.test(t))&&(e=y(e),s.domain=e):s.domain=function(e){if(e)return e;e=f.location.hostname;var t=/([a-zA-Z0-9_\-]+\.[a-zA-Z]{2,})$/.exec(e);return t?t[0]:e}()}function ze(e){"boolean"==typeof e&&(s.routerListener=e)}function Ve(e){e&&P(e)&&0<e.length&&x(e,function(e,t){switch(e[0]){case"setGatherServer":je(e[1]);break;case"setGatherError":Be(e[1]);break;case"setPageUrl":Je(e[1]);break;case"setAppId":Ue(e[1]);break;case"setVersion":Ge(e[1]);break;case"setDomain":He(e[1]);break;case"setRouterListener":ze(e[1]);break;case"setGatherMore":i=e[1],s.gatherMore.push(i);break;case"setRecoverGatherMore":n=e[1],s.recoverGatherMore=[],s.recoverGatherMore.push(n);break;case"setScrollDom":(r=e[1])&&(s.scrollDom=r);break;case"uaTrack":Oe(e[1],e[2]);break;case"trackPageLoad":Ne();break;case"exitAndLoad":$e(e[1],e[2])}var r,n,i})}function $e(e,t){var r;e?(ke(),s.startTime.startTime=+new Date,Je(e),(t=t||f.location.href)&&(r=t)&&(H(r)||(r=y(r)),s.referrer=r),Ne()):c.error("params pageUrl is require, in TPM.exitAndLoad method.")}if(s.debug=!1,s.debug=!1,"undefined"==typeof window)throw new Error("Error: gather not support, please make sure run in modern browser");s.inFrame=function(){if(f.top==f)return!1;var e=d.body;try{return 0!==e.clientHeight&&!(320<=e.clientHeight&&240<=e.clientWidth)}catch(e){return!0}}(),(ce=function(){for(var e={},t=d.getElementsByTagName("script"),r=0;r<t.length;r++)if(new RegExp("/tpm-([0-9.]+)(-[a-z]+.[0-9]+)?(.min)?.js").test(t[r].src)){e=z(t[r].src);break}return e}()).gatherServer&&je(ce.gatherServer),ce.gatherError&&Be(ce.gatherError),ce.appId&&Ue(ce.appId),ce.version&&Ge(ce.version),ce.pageUrl&&Je(ce.pageUrl),He(ce.domain),ce.routerListener&&ze(ce.routerListener),f.TPM=f.TPM||[];var qe=f.TPM;window.addEventListener("message",ue,!1),a(function(){0<qe.length&&(Ve(qe),qe.length=0),Ne(),De(),u(d.body,"mouseover",_e),u(d.body,"mouseout",Ee),u(d.body,"click",Me),u(f,"error",Ae),u(f,"beforeunload",ke),u(d,"visibilitychange",De)}),qe.push=function(e){e=Array.prototype.slice.call(e),P(e)&&0<e.length&&Ve([e])};function Fe(e,t){return function(){try{return t&&t(),e.apply(null,arguments)}catch(e){_(e)}}}return qe.trackPageLoad=Fe(Ne,function(){s.startTime.startTime=+new Date}),qe.exitAndLoad=Fe($e),qe.uaTrack=Fe(Oe),function(){try{var n=f.history,i=n.replaceState;n.replaceState=function(e,t,r){try{return s.routerListener&&(r=b(r))&&r!==f.location.href&&r&&$e(r),i.apply(n,arguments)}catch(e){c.error("window.history.replaceState error.",e)}};var o=n.pushState;n.pushState=function(e,t,r){try{return s.routerListener&&r&&$e(r),o.apply(n,arguments)}catch(e){c.error("window.history.pushState error.",e)}}}catch(e){c.error("window.history rewrite error.")}}(),qe});